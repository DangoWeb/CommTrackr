<%- include('head.ejs') %>
<img src="<%= tenant.logo %>" alt="<%= tenant.name %>">
<h1><%= title %></h1>
<% if (role === 'admin') { %>
<% if (!vars.disableFieldEditing.includes('status')) { %>
<div class="inputField active" id="status">
	<h3><%= tenant.customText && tenant.customText.labelStatus ? tenant.customText.labelStatus : 'Status' %>*</h3>
	<p><%= tenant.customText && tenant.customText.labelStatusDescription ? tenant.customText.labelStatusDescription : 'Required: Commission status.' %></p>
	<select id="statusSelect">
		<% vars.possibleStatuses.forEach(option => { %>
		<option value="<%= option.value %>" <%= (option.value === commission.status) ? 'selected' : '' %>><%= option.label %></option>
		<% }) %>
	</select>
</div>
<% } %>
<% if (!vars.disableFieldEditing.includes('owner')) { %>
<div class="inputField active" id="owner">
	<h3><%= tenant.customText && tenant.customText.labelOwner ? tenant.customText.labelOwner : 'Owner' %>*</h3>
	<p><%= tenant.customText && tenant.customText.labelOwnerDescription ? tenant.customText.labelOwnerDescription : 'Required: Commission owner.' %></p>
	<% if ((vars.users || []).filter(user => getUserRole(user) === 'user').length) { %>
	<select id="ownerSelect">
		<option value="">None</option>
		<% vars.users.filter(user => getUserRole(user) === 'user').forEach(user => { %>
		<option value="<%= user[vars.userId] %>" <%= (commission.user === user[vars.userId]) ? 'selected' : '' %>><%= user[vars.userName] ? `${user[vars.userName]} (${user[vars.userId]})` : user[vars.userId] %></option>
		<% }) %>
	</select>
	<% } else { %>
	<input id="ownerInput" type="text" placeholder="<%= commission.user %>" value="<%= commission.user %>">
	<% } %>
</div>
<% } %>
<% if (!vars.disableFieldEditing.includes('amount')) { %>
<div class="inputField active" id="amount">
	<h3><%= tenant.customText && tenant.customText.labelAmount ? tenant.customText.labelAmount : 'Amount' %></h3>
	<p><%= tenant.customText && tenant.customText.labelAmountDescription ? tenant.customText.labelAmountDescription : 'Optional: Commission amount.' %></p>
	<input id="amountInput" type="number" step="0.01" placeholder="<%= (commission.amount !== null) ? commission.amount : '' %>" value="<%= (commission.amount !== null) ? commission.amount : '' %>">
</div>
<% } %>
<% if (!vars.disableFieldEditing.includes('currency')) { %>
<div class="inputField active" id="currency">
	<h3><%= tenant.customText && tenant.customText.labelCurrency ? tenant.customText.labelCurrency : 'Currency' %></h3>
	<p><%= tenant.customText && tenant.customText.labelCurrencyDescription ? tenant.customText.labelCurrencyDescription : 'Optional: Commission currency.' %></p>
	<input id="currencyInput" type="text" placeholder="<%= (commission.currency !== null) ? commission.currency : '' %>" value="<%= (commission.currency !== null) ? commission.currency : '' %>">
</div>
<% } %>
<% if (!vars.disableFieldEditing.includes('date')) { %>
<div class="inputField active" id="date">
	<h3><%= tenant.customText && tenant.customText.labelDate ? tenant.customText.labelDate : 'Date' %></h3>
	<p><%= tenant.customText && tenant.customText.labelDateDescription ? tenant.customText.labelDateDescription : 'Optional: Commission creation date.' %></p>
	<input id="dateInput" type="datetime-local" placeholder="<%= (commission.date !== null) ? new Date(commission.date).toISOString().slice(0,16) : '' %>" value="<%= (commission.date !== null) ? new Date(commission.date).toISOString().slice(0,16) : '' %>">
</div>
<% } %>
<% if (!vars.disableFieldEditing.includes('locked')) { %>
<div class="inputField active" id="locked">
	<h3><%= tenant.customText && tenant.customText.labelLocked ? tenant.customText.labelLocked : 'Locked' %></h3>
	<p><%= tenant.customText && tenant.customText.labelLockedDescription ? tenant.customText.labelLockedDescription : 'Optional: Whether or not the commission is locked from user editing.' %></p>
	<input id="lockedInput" type="checkbox" class="hidden" <%= commission.locked ? 'checked' : '' %>>
	<div class="checkbox">|||</div>
</div>
<% } %>
<% if (!vars.disableFieldEditing.includes('assignedTo')) { %>
<div class="inputField active" id="assignedTo">
	<h3><%= tenant.customText && tenant.customText.labelAssignedTo ? tenant.customText.labelAssignedTo : 'Assigned To' %></h3>
	<p><%= tenant.customText && tenant.customText.labelAssignedToDescription ? tenant.customText.labelAssignedToDescription : 'Optional: The developer to assign this commission to.' %></p>
	<% if ((vars.users || []).filter(user => getUserRole(user) !== 'user').length) { %>
	<select id="assignedToSelect" multiple>
		<option value="">None</option>
		<% vars.users.filter(user => getUserRole(user) !== 'user').forEach(user => { %>
		<option value="<%= user[vars.userId] %>" <%= ((commission.assignedTo || []).includes(user[vars.userId])) ? 'selected' : '' %>><%= user[vars.userName] ? `${user[vars.userName]} (${user[vars.userId]})` : user[vars.userId] %></option>
		<% }) %>
	</select>
	<% } else { %>
	<p>No developers found.</p>
	<% } %>
</div>
<% } %>
<% } %>
<% if (role !== 'dev') { %>
<% fields.forEach(field => { %>
<div class="inputField active <%= field.required ? 'required' : '' %>" id="<%= field.id %>">
	<h3><%= field.label %><%= field.required ? '*' : '' %></h3>
	<p><%= field.required ? 'Required' : 'Optional' %><%= field.description ? ': ' + field.description : '' %></p>
	<% if (field.type === 'textarea') { %>
	<textarea id="<%= field.id %>Textarea" placeholder="<%= field.placeholder || '' %>" <%= field.required ? 'required' : '' %>></textarea>
	<% } else if (field.type === 'checkbox') { %>
	<input id="<%= field.id %>Input" type="checkbox" class="hidden">
	<div class="checkbox">|||</div>
	<% } else if (field.type === 'radio') { %>
	<div class="radioOptions">
		<% if (!field.required) { %>
		<div class="radioOption">
			<input type="radio" id="none" name="none" value="">
			<label for="none">None</label>
		</div>
		<% } %>
		<% (field.options || []).forEach(option => { %>
		<div class="radioOption">
			<input type="radio" id="<%= field.id %>-<%= option.value %>" name="<%= option.value %>" value="<%= option.value %>">
			<label for="<%= field.id %>-<%= option.value %>"><%= option.label %></label>
		</div>
		<% }) %>
	</div>
	<% } else if (field.type === 'select') { %>
	<select id="<%= field.id %>Select">
		<% if (!field.required) { %>
		<option value="">None</option>
		<% } %>
		<% (field.options || []).forEach(option => { %>
		<option value="<%= option.value %>"><%= option.label %></option>
		<% }) %>
	</select>
	<% } else { %>
	<input id="<%= field.id %>Input" type="<%= field.type %>" placeholder="<%= field.placeholder || '' %>" <%= field.required ? 'required' : '' %>>
	<% } %>
</div>
<% }) %>
<% } %>
<% if (role !== 'user') { %>
<table>
	<tbody>
		<tr>
			<th>
				<h3><%= tenant.customText && tenant.customText.labelTasks ? tenant.customText.labelTasks : 'Tasks' %></h3>
			</th>
		</tr>
		<% commission.tasks.forEach(task => { %>
		<tr>
			<th class="checkbox <%= task.done ? 'checked' : '' %>" change="task<%= commission.tasks.indexOf(task) %>Done"><input id="task<%= commission.tasks.indexOf(task) %>Done" type="checkbox" class="hidden">|||</th>
			<td id="task<%= commission.tasks.indexOf(task) %>Input"><%= task.content %></td>
		</tr>
		<% }) %>
		<tr>
			<th>
				<div id="addTask" class="button"><%= tenant.customText && tenant.customText.newTaskLabel ? tenant.customText.newTaskLabel : 'New Task' %></div>
			</th>
		</tr>
	</tbody>
</table>
<div class="inputField active" id="sendEmail">
	<h3><%= tenant.customText && tenant.customText.labelSendEmail ? tenant.customText.labelSendEmail : 'Send Email' %></h3>
	<p><%= tenant.customText && tenant.customText.labelSendEmailDescription ? tenant.customText.labelSendEmailDescription : 'Optional: Send an email to the user regarding this update.' %></p>
	<input id="sendEmailInput" type="checkbox" class="hidden">
	<div class="checkbox">|||</div>
</div>
<% } %>
<div class="buttons">
	<% if (!commission.locked || (role !== 'user')) { %><div id="save" class="button"><%= tenant.customText && tenant.customText.saveLabel ? tenant.customText.saveLabel : 'Save' %></div><% } %>
	<a id="error" class="button active hidden" href="<%= tenant.domain %><%= tenant.path %>/<%= commission.id %>/edit"><%= tenant.customText && tenant.customText.restartLabel ? tenant.customText.restartLabel : 'Restart' %></a>
</div>
<script>
	const commissionId = '<%= commission.id %>';
	const restore = <%- JSON.stringify(commission.fields) %>;
</script>
<%- include('foot.ejs') %>