<%- include('head.ejs') %>
<img src="<%= tenant.logo %>" alt="<%= tenant.name %>">
<h1><%= title %></h1>
<% if (commission.locked) { %><p><%= tenant.customText && tenant.customText.commissionLocked ? tenant.customText.commissionLocked : 'This commission is locked from user editing.' %></p><% } %>
<table>
	<tbody>
		<tr>
			<th><%= tenant.customText && tenant.customText.labelStatus ? tenant.customText.labelStatus : 'Status' %></th>
			<td><%= commission.status %></td>
		</tr>
		<tr>
			<th><%= tenant.customText && tenant.customText.labelOwner ? tenant.customText.labelOwner : 'Owner' %></th>
			<td><%= commission.user %><%= (commission.user === session[vars.userId]) ? (' ' + (tenant.customText && tenant.customText.youLabel ? tenant.customText.youLabel : '(you)')) : '' %></td>
		</tr>
		<% if (commission.amount !== null) { %>
		<tr>
			<th><%= tenant.customText && tenant.customText.labelAmount ? tenant.customText.labelAmount : 'Amount' %></th>
			<td><%= commission.amount %> <%= commission.currency %></td>
		</tr>
		<% } %>
		<% if (commission.date !== null) { %>
		<tr>
			<th><%= tenant.customText && tenant.customText.labelDate ? tenant.customText.labelDate : 'Date' %></th>
			<td><%= new Date(commission.date).toLocaleString() %></td>
		</tr>
		<% } %>
		<tr>
			<th><%= tenant.customText && tenant.customText.labelAssignedTo ? tenant.customText.labelAssignedTo : 'Assigned To' %></th>
			<td><%= (commission.assignedTo || []).map(assignedTo => vars.users.find(user => user[vars.userId] === assignedTo) ? (vars.users.find(user => user[vars.userId] === assignedTo)[vars.userName] || vars.users.find(user => user[vars.userId] === assignedTo)[vars.userId]) : null).filter(assignedTo => assignedTo).join(', ') || '-' %></td>
		</tr>
	</tbody>
</table>
<table>
	<tbody>
		<% for (const field of fields) { %>
		<tr>
			<th><%= field.label %></th>
			<% switch (field.type) {
			case 'number': %>
			<td><%= (commission.fields[field.id] === null) ? '-' : Number(commission.fields[field.id]) %></td>
			<% break;
			case 'date': %>
			<td><%= isNaN(new Date(commission.fields[field.id]).getTime()) ? '-' : new Date(commission.fields[field.id]).toLocaleString() %></td>
			<% break;
			case 'checkbox': %>
			<td><%= commission.fields[field.id] ? 'Yes': 'No' %></td>
			<% break;
			case 'radio': %>
			<td><%= commission.fields[field.id] || '-' %></td>
			<% break;
			case 'select': %>
			<td><%= commission.fields[field.id] || '-' %></td>
			<% break;
			default: %>
			<td><%= commission.fields[field.id] || '-' %></td>
			<% break;
			} %>
		</tr>
		<% } %>
	</tbody>
</table>
<table>
	<tbody>
		<tr>
			<th>
				<h3>Tasks</h3>
				<% if (!commission.tasks.length) { %><p>No tasks.</p><% } %>
			</th>
		</tr>
		<% commission.tasks.forEach(task => { %>
		<tr>
			<th class="checkbox <%= task.done ? 'checked' : '' %>" disabled>|||</th>
			<td><%= task.content %></td>
		</tr>
		<% }) %>
	</tbody>
</table>
<div class="buttons">
	<a class="button" href="<%= tenant.domain %><%= tenant.path %>">Back</a>
	<% if (!commission.locked || (role !== 'user')) { %><a class="button" href="<%= tenant.domain %><%= tenant.path %>/<%= commission.id %>/edit">Edit</a><% } %>
	<% commission.links.forEach(link => { %><a class="button" href="<%= link.url %>" target="_blank" rel="noopener noreferrer"><%= link.label %></a><% }); %>
</div>
<%- include('foot.ejs') %>